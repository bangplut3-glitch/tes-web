<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DanaPintar - Aplikasi Pencatat Keuangan</title>
    <!-- Tailwind CSS untuk Styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js untuk Grafik -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-5xl mx-auto">
        <!-- Header -->
        <header class="flex justify-between items-center mb-8">
            <div>
                <h1 class="text-3xl font-bold text-slate-800 flex items-center gap-2">
                    <i data-lucide="wallet" class="text-indigo-600"></i> DanaPintar
                </h1>
                <p class="text-slate-500">Kelola keuangan Anda dengan lebih bijak.</p>
            </div>
            <button onclick="exportData()" class="bg-white border border-slate-200 px-4 py-2 rounded-lg text-sm font-medium hover:bg-slate-50 transition flex items-center gap-2">
                <i data-lucide="download" class="w-4 h-4"></i> Ekspor CSV
            </button>
        </header>

        <!-- Ringkasan Kartu -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                <p class="text-sm text-slate-500 font-medium mb-1">Total Saldo</p>
                <h2 id="total-balance" class="text-2xl font-bold text-slate-800">Rp 0</h2>
                <div class="mt-4 h-1 w-full bg-slate-100 rounded-full overflow-hidden">
                    <div class="h-full bg-indigo-500 w-full"></div>
                </div>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                <p class="text-sm text-slate-500 font-medium mb-1 text-emerald-600">Pemasukan</p>
                <h2 id="total-income" class="text-2xl font-bold text-slate-800">Rp 0</h2>
                <div class="mt-4 flex items-center text-xs text-emerald-600 font-medium">
                    <i data-lucide="trending-up" class="w-3 h-3 mr-1"></i> Uang Masuk
                </div>
            </div>
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                <p class="text-sm text-slate-500 font-medium mb-1 text-rose-600">Pengeluaran</p>
                <h2 id="total-expense" class="text-2xl font-bold text-slate-800">Rp 0</h2>
                <div class="mt-4 flex items-center text-xs text-rose-600 font-medium">
                    <i data-lucide="trending-down" class="w-3 h-3 mr-1"></i> Uang Keluar
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Form Input & Chart -->
            <div class="lg:col-span-1 space-y-6">
                <!-- Form -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                    <h3 class="font-semibold text-slate-800 mb-4">Tambah Transaksi</h3>
                    <form id="transaction-form" class="space-y-4">
                        <div>
                            <label class="block text-xs font-semibold text-slate-500 uppercase mb-1">Deskripsi</label>
                            <input type="text" id="desc" required placeholder="Gaji, Belanja, Makan..." class="w-full px-4 py-2 rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition">
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-slate-500 uppercase mb-1">Jumlah (Rp)</label>
                            <input type="number" id="amount" required placeholder="Contoh: 50000" class="w-full px-4 py-2 rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition">
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-slate-500 uppercase mb-1">Jenis</label>
                            <select id="type" class="w-full px-4 py-2 rounded-lg border border-slate-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition">
                                <option value="income">Pemasukan</option>
                                <option value="expense">Pengeluaran</option>
                            </select>
                        </div>
                        <button type="submit" class="w-full bg-indigo-600 text-white font-semibold py-3 rounded-lg hover:bg-indigo-700 transition shadow-md shadow-indigo-100">
                            Simpan Transaksi
                        </button>
                    </form>
                </div>

                <!-- Grafik Ringkasan -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                    <h3 class="font-semibold text-slate-800 mb-4 text-center">Analisis Visual</h3>
                    <div class="relative h-48 flex justify-center">
                        <canvas id="financeChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Riwayat Transaksi -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden h-full flex flex-col">
                    <div class="p-6 border-b border-slate-100 flex justify-between items-center">
                        <h3 class="font-semibold text-slate-800">Riwayat Transaksi</h3>
                        <span id="transaction-count" class="text-xs bg-slate-100 px-2 py-1 rounded-full text-slate-500">0 transaksi</span>
                    </div>
                    <div id="transaction-list" class="flex-grow overflow-y-auto custom-scrollbar p-6 space-y-4 max-h-[600px]">
                        <!-- List Item akan muncul di sini via JS -->
                        <div class="text-center py-20 text-slate-400">
                            <i data-lucide="clipboard-list" class="w-12 h-12 mx-auto mb-2 opacity-20"></i>
                            <p>Belum ada transaksi tercatat.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="notification" class="fixed bottom-4 right-4 translate-y-20 opacity-0 bg-slate-800 text-white px-6 py-3 rounded-xl shadow-xl transition-all duration-300 flex items-center gap-3">
        <span id="notif-message">Pesan di sini</span>
    </div>

    <script>
        // State Management
        let transactions = JSON.parse(localStorage.getItem('danaPintar_transactions')) || [];
        let chart;

        // Init Lucide Icons
        lucide.createIcons();

        // DOM Elements
        const form = document.getElementById('transaction-form');
        const list = document.getElementById('transaction-list');
        const balanceEl = document.getElementById('total-balance');
        const incomeEl = document.getElementById('total-income');
        const expenseEl = document.getElementById('total-expense');
        const countEl = document.getElementById('transaction-count');

        // Format Rupiah
        function formatRupiah(number) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(number);
        }

        // Show Notification
        function showNotification(msg) {
            const notif = document.getElementById('notification');
            const notifMsg = document.getElementById('notif-message');
            notifMsg.innerText = msg;
            notif.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => {
                notif.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }

        // Update UI
        function updateUI() {
            const amounts = transactions.map(t => t.type === 'income' ? t.amount : -t.amount);
            const total = amounts.reduce((acc, item) => (acc += item), 0);
            
            const income = transactions
                .filter(t => t.type === 'income')
                .reduce((acc, item) => (acc += item.amount), 0);
            
            const expense = transactions
                .filter(t => t.type === 'expense')
                .reduce((acc, item) => (acc += item.amount), 0);

            balanceEl.innerText = formatRupiah(total);
            incomeEl.innerText = formatRupiah(income);
            expenseEl.innerText = formatRupiah(expense);
            countEl.innerText = `${transactions.length} transaksi`;

            // Update List
            list.innerHTML = '';
            if (transactions.length === 0) {
                list.innerHTML = `
                    <div class="text-center py-20 text-slate-400">
                        <i data-lucide="clipboard-list" class="w-12 h-12 mx-auto mb-2 opacity-20"></i>
                        <p>Belum ada transaksi tercatat.</p>
                    </div>`;
            } else {
                [...transactions].reverse().forEach(t => {
                    const item = document.createElement('div');
                    const isIncome = t.type === 'income';
                    
                    item.className = 'flex items-center justify-between p-4 bg-slate-50 rounded-xl hover:bg-slate-100 transition group';
                    item.innerHTML = `
                        <div class="flex items-center gap-4">
                            <div class="p-2 rounded-full ${isIncome ? 'bg-emerald-100 text-emerald-600' : 'bg-rose-100 text-rose-600'}">
                                <i data-lucide="${isIncome ? 'arrow-up-right' : 'arrow-down-left'}" class="w-5 h-5"></i>
                            </div>
                            <div>
                                <h4 class="font-medium text-slate-800">${t.description}</h4>
                                <p class="text-xs text-slate-400">${t.date}</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-4">
                            <span class="font-semibold ${isIncome ? 'text-emerald-600' : 'text-rose-600'}">
                                ${isIncome ? '+' : '-'} ${formatRupiah(t.amount)}
                            </span>
                            <button onclick="deleteTransaction(${t.id})" class="text-slate-300 hover:text-rose-500 opacity-0 group-hover:opacity-100 transition">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        </div>
                    `;
                    list.appendChild(item);
                });
            }
            lucide.createIcons();
            updateChart(income, expense);
            localStorage.setItem('danaPintar_transactions', JSON.stringify(transactions));
        }

        // Delete Logic
        function deleteTransaction(id) {
            transactions = transactions.filter(t => t.id !== id);
            showNotification('Transaksi berhasil dihapus');
            updateUI();
        }

        // Add Logic
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const desc = document.getElementById('desc').value;
            const amount = parseFloat(document.getElementById('amount').value);
            const type = document.getElementById('type').value;

            if (amount <= 0) return showNotification('Jumlah harus lebih dari 0');

            const newTransaction = {
                id: Math.floor(Math.random() * 1000000),
                description: desc,
                amount: amount,
                type: type,
                date: new Date().toLocaleString('id-ID', { dateStyle: 'medium', timeStyle: 'short' })
            };

            transactions.push(newTransaction);
            form.reset();
            showNotification('Transaksi disimpan!');
            updateUI();
        });

        // Chart Initialization
        function initChart() {
            const ctx = document.getElementById('financeChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Pemasukan', 'Pengeluaran'],
                    datasets: [{
                        data: [0, 0],
                        backgroundColor: ['#10b981', '#f43f5e'],
                        borderWidth: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' }
                    },
                    cutout: '70%'
                }
            });
        }

        function updateChart(income, expense) {
            if (chart) {
                chart.data.datasets[0].data = [income, expense];
                chart.update();
            }
        }

        // Export to CSV
        function exportData() {
            if (transactions.length === 0) return showNotification('Tidak ada data untuk diekspor');
            
            let csv = 'Tanggal,Deskripsi,Jenis,Jumlah\n';
            transactions.forEach(t => {
                csv += `${t.date},${t.description},${t.type === 'income' ? 'Pemasukan' : 'Pengeluaran'},${t.amount}\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.setAttribute('href', url);
            a.setAttribute('download', `Laporan_Keuangan_${new Date().toLocaleDateString()}.csv`);
            a.click();
            showNotification('Laporan CSV diunduh');
        }

        // Initialize App
        window.onload = () => {
            initChart();
            updateUI();
        };
    </script>
</body>
</html>
